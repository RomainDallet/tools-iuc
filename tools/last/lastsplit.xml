<tool id="last_split" name="LAST-split" version="@LAST_CONDA_VERSION@+galaxy0" python_template_version="3.5">

    <description>finds "split alignments" (typically for DNA) or "spliced alignments" (typically for RNA).</description>

    <macros>
        <import>macros_last.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="@LAST_CONDA_VERSION@">last</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        last-split

        -f $output_format
        -g ref_db
        -d $lastsplit_opt.direction
        -c $lastsplit_opt.cis_prob
        -t $lastsplit_opt.trans_prob
        -M $lastsplit_opt.mean
        -S $lastsplit_opt.sdev
        -m $lastsplit_opt.mismap
        $lastsplit_opt.no_split
        -b \$GALAXY_MEMORY_MB
        '$last_align'

        >'$outfile'
    ]]></command>
    <!--
        Add lastdb genome files in the working directory
        -s $lastsplit.score
    -->
    <inputs>
        <param name="lastdb_genome" type="data" label="LASTdb data file" />
        <param name="last_align" type="data" format="maf" label="LASTal data file" />
        <param name="output_format" argument="-f" type="select" multiple="false" label="Output format">
            <option value="MAF">MAF</option>
            <option value="MAF+" selected="true">MAF+</option>
        </param>
        <section name="lastsplit_opt" title="Last-split options" expanded="false">
            <param name="direction" argument="-d" type="select" multiple="false" label="RNA direction">
                <option value="0">Reverse</option>
                <option value="1" selected="true">Forward</option>
                <option value="2">Mixed</option>
            </param>    
            <param name="cis_prob" argument="-c" type="float" value="0.004" label="Cis-splice probability per base"/>
            <param name="trans_prob" argument="-t" type="float" value="0.00001" label="Trans-splice probability per base"/>
            <param name="mean" argument="-M" type="float" value="7" label="Mean of ln[intron length]"/>
            <param name="sdev" argument="-S" type="float" value="1.7" label="Standard deviation of ln[intron length]"/>
            <param name="mismap" argument="-m" type="float" value="1" label="Maximum mismap probability"/>
            <!--<param name="score" argument="-s" type="int" value="lastal e" label="Minimum alignement score"/>-->
            <param name="no_split" argument="-n" type="boolean" truevalue="-n" falsevalue="" checked="false" label="Write original, not split, alignement."/>
        </section>
    </inputs>

    <outputs>
        <data name="outfile" format="maf" label="LAST split from  ${on_string}" />
    </outputs>

    <tests>
        <test>
            <param name="ref_fasta" value="humanMito.fa" />
            <param name="int_fasta" value="fuguMito.fa" />
            <param name="args_db" value="-cR01" />
            <output name="split_result" file="humanMito-fuguMito.maf" />
        </test>
    </tests>

    <help>@LAST_HELP@</help>
    <citations><expand macro="citations"/></citations>
</tool>
